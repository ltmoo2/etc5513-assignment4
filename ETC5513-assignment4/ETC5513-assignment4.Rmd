---
title: "ETC5513-Assignment4"
author:
- familyname: 
  othernames: 
  address: Monash University
  email: 
  correspondingauthor: true
  qualifications:
- familyname: 
  othernames: 
  address: Monash University
  email: 
  correspondingauthor: true
  qualifications:
- familyname: 
  othernames: 
  address: Monash University
  email: 
  correspondingauthor: true
  qualifications:
- familyname: 
  othernames: 
  address: Monash University
  email: 
  correspondingauthor: true
  qualifications:
department: Department of\newline Econometrics &\newline Business Statistics
organization: Acme Corporation
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  MonashEBSTemplates::report:
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache=TRUE, messages=FALSE, warning=FALSE, fig.pos = 'H')

library(tidyverse)
library(ggplot2)
library(kableExtra)
library(here)
library(gganimate)
```


```{r readingdata, message = FALSE, warning = FALSE}
expectancy <- read_csv(here::here("data", "life_expectancy.csv"))
names(expectancy) <- paste(names(expectancy), expectancy[1, ], sep = "_") ## Merging first two header rows together to get row names
expectancy <- expectancy[-1,] ## Removing now unnecessary firt row

spend <- read_csv(here::here("data", "health_expenditure.csv"), skip = 1)

gdp <- read_csv(here::here("data", "gdp_data.csv"), skip = 3)

head(expectancy,10)

head(spend, 10)
head(gdp, 10)
```

 
\section*{Introduction}



\section*{Differences between men and women}



\section*{Differences betweetn countries}



\section*{Life expectancy at birth vs at 60}



\section*{Life expectancy and Gross Domestic Product}

```{r}
T_population <- read_csv(here::here("data/Population_data.csv"), skip = 3) %>%
    select(`Country Name`, "2016") %>%
    rename(population = "2016")
T_continent <-read_csv("https://raw.githubusercontent.com/dbouquin/IS_608/master/NanosatDB_munging/Countries-Continents.csv") #Name for continent, nothing too important

T_expectancy_tidy1 <- expectancy %>%
    rename(life_exp = "Life expectancy at birth (years)_Both sexes",
    country = X1_Country,
    year = X2_Year) %>%
    filter(year == "2016") %>%
    select(country, life_exp) %>% 
    mutate(country = recode(country,
                  "Bolivia (Plurinational State of)" =  "Bolivia",
                  "United Kingdom of Great Britain and Northern Ireland" = "United Kingdom" ,
                  "Republic of Moldova" = "Moldova",
                  "United Republic of Tanzania" =  "Tanzania" ,
                   "Viet Nam" = "Vietnam" )) #Rename observations that have different names in different data sets.

T_gdp_tidy <- gdp %>%
    select(`Country Name`, "2016") %>%
    rename(GDP = "2016")
T_tidy <-  left_join(T_gdp_tidy, T_population) %>%
    left_join(T_continent, by = c("Country Name" = "Country")) %>%
    na.omit()
T_tidy2 <- left_join(T_tidy, T_expectancy_tidy1, by = c("Country Name" = "country"))
T_plot_dat <- T_tidy2 %>% mutate(PPP = (GDP/population),
    life_exp = as.numeric(life_exp)) %>%
    na.omit()
```

``` {r fig1T}
T_plot <- ggplot(T_plot_dat, 
                 aes(x = GDP, y = life_exp)) +
    geom_point(aes(group = `Country Name`,color = Continent, size = population)) +
  scale_color_brewer(palette= "Dark2")+
  ggtitle("Life Expectancy and Income World wide in 2016 ")

ggplotly(T_plot) %>%
  layout(legend = list(orientation = 'b'))
```

Figure \@ref(fig:fig1T) shows income and lifespan in the world in 2016. Each point is a country. Color shows region while size shows population. X axis shows GDP per capita and Y axis shows lifespan in years. The countries with lower income tend to have lower life expectancy. No high income countries have short life expectancy, and no low income countries have long life expectancy. Most people live in mid income countries. Figure \@ref(fig:fig2T) shows the life expectancy of countries with GDP per capita less then 20000USD. There are huge different in lifespan on the same income level, depending on the country's health expenditure.

```{r fig2T}
T_plot2 <- T_plot_dat %>% filter(!GDP > 20000) %>%
  ggplot( aes(x = GDP, y = life_exp, size = population)) +
    geom_point(aes(group = `Country Name`,color = Continent)) +
  scale_color_brewer(palette= "Dark2")+
  scale_x_continuous(breaks = seq(0, 25000, by = 2500))+
  theme(legend.position = "bottom") 
ggplotly(T_plot2) %>%
layout(showlegend = FALSE)
```